<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Update Profile</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>

/* ---------- Background same as employee page ---------- */
body {
  margin: 0;
  padding: 20px;
  font-family: "Poppins", Arial, sans-serif;
  min-height: 100vh;
  background: radial-gradient(circle at top left, #93c5fd 0%, #dbeafe 45%, #f8fafc 80%);
}

/* Glow balls */
body::before,
body::after {
  content: "";
  position: fixed;
  width: 260px;
  height: 260px;
  border-radius: 999px;
  filter: blur(60px);
  opacity: 0.45;
  z-index: -1;
}
body::before {
  top: -60px;
  left: -40px;
  background: #60a5fa;
}
body::after {
  bottom: -50px;
  right: -40px;
  background: #f472b6;
}

/* ---------- Main Glass Card ---------- */
.container {
  max-width: 480px;
  margin: 40px auto;
  padding: 28px;
  border-radius: 22px;
  background: rgba(255,255,255,0.65);
  border: 1px solid rgba(148,163,184,0.32);
  box-shadow: 0 12px 26px rgba(15,23,42,0.18);
  backdrop-filter: blur(14px);
  text-align: center;
}

/* Title */
h2 {
  margin: 0 0 18px;
  font-size: 24px;
  font-weight: 700;
  color: #0f172a;
}

/* Profile Image */
.profile-img {
  width: 140px;
  height: 140px;
  border-radius: 999px;
  object-fit: cover;
  border: 5px solid rgba(255,255,255,0.95);
  box-shadow: 0px 6px 20px rgba(0,0,0,0.25);
  margin-bottom: 12px;
}

/* Inputs */
input {
  width: 100%;
  padding: 12px;
  margin-top: 14px;
  font-size: 15px;
  border-radius: 14px;
  outline: none;
  border: 1px solid rgba(148,163,184,0.35);
  background: rgba(255,255,255,0.8);
  backdrop-filter: blur(6px);
}
input:focus {
  border-color: #3b82f6;
  background: rgba(255,255,255,0.95);
}
input[readonly] {
  background: rgba(226,232,240,0.85);
  color: #475569;
}

/* Buttons */
button {
  margin-top: 22px;
  width: 100%;
  padding: 12px;
  border-radius: 14px;
  border: none;
  font-size: 16px;
  font-weight: 600;
  color: white;
  background: linear-gradient(135deg,#2563eb,#38bdf8);
  box-shadow: 0 5px 14px rgba(37,99,235,0.35);
  cursor: pointer;
}
button:hover {
  background: linear-gradient(135deg,#1e40af,#0ea5e9);
}

/* Back button */
.back {
  display: block;
  margin-top: 16px;
  padding: 12px;
  border-radius: 14px;
  text-align: center;
  background: rgba(100,116,139,0.75);
  color: white;
  text-decoration: none;
}
.back:hover {
  background: rgba(71,85,105,0.95);
}

</style>
</head>



<body>

<div class="container">

  <h2>Update Profile</h2>

  <!-- Profile Image Preview -->
  <img id="profilePreview" class="profile-img"
       src="https://cdn-icons-png.flaticon.com/512/149/149071.png">

  <input type="file" id="photoInput" accept="image/*">

  <input id="name" placeholder="Name">
  <input id="mobile" placeholder="Mobile">

  <!-- Email locked -->
  <input id="email" placeholder="Email" readonly>

  <input id="address" placeholder="Address">

  <button onclick="saveProfile()">Save Profile</button>

  <a class="back" href="profile.html">‚Üê Back to Profile</a>

</div>




<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import {
  getFirestore, doc, setDoc, getDoc
} from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

import {
  getAuth, onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";


/* FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyApcn2ckkvfLaEuKEKOZfC6hcEfx44ZDJ0",
  authDomain: "tak-agro.firebaseapp.com",
  projectId: "tak-agro",
  storageBucket: "tak-agro.firebasestorage.app",
  messagingSenderId: "158309293772",
  appId: "1:158309293772:web:ebca377434d940d0b5ac69"
};

const app  = initializeApp(firebaseConfig);
const db   = getFirestore(app);
const auth = getAuth(app);

const OWNER_EMAIL = "bhuraramtak81@gmail.com";
let selectedImageBase64 = "";


/* LOAD EXISTING PROFILE */
onAuthStateChanged(auth, async (user) => {
  if (!user) return (window.location.href = "login.html");
  if (user.email !== OWNER_EMAIL) return (window.location.href = "login.html");

  document.getElementById("email").value = user.email;

  const snap = await getDoc(doc(db, "profiles", "owner"));
  if (snap.exists()) {
    const data = snap.data();
    document.getElementById("name").value    = data.name || "";
    document.getElementById("mobile").value  = data.mobile || "";
    document.getElementById("address").value = data.address || "";

    if (data.photoURL) {
      document.getElementById("profilePreview").src = data.photoURL;
    }
  }
});


/* IMAGE SIZE CHECK + PREVIEW */
document.getElementById("photoInput").addEventListener("change", function () {

  const file = this.files[0];
  if (!file) return;

  if (file.size > 1024 * 1024) {
    Swal.fire("Error", "Image must be less than 1 MB!", "error");
    this.value = "";
    return;
  }

  const reader = new FileReader();
  reader.onload = () => {
    selectedImageBase64 = reader.result;
    document.getElementById("profilePreview").src = selectedImageBase64;
  };
  reader.readAsDataURL(file);
});


/* SAVE PROFILE */
window.saveProfile = async function () {

  let name    = document.getElementById("name").value.trim();
  let mobile  = document.getElementById("mobile").value.trim();
  let address = document.getElementById("address").value.trim();

  Swal.fire({
    title: "Saving...",
    showConfirmButton: false,
    allowOutsideClick: false
  });

  try {
    await setDoc(doc(db, "profiles", "owner"), {
      name,
      mobile,
      address,
      ...(selectedImageBase64 ? { photoURL: selectedImageBase64 } : {})
    });

    Swal.fire("Success", "Profile updated successfully!", "success");

    setTimeout(() => window.location.href = "profile.html", 900);

  } catch (err) {
    Swal.fire("Error", err.message, "error");
  }
};

</script>

</body>
</html>
